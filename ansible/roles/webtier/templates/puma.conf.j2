# {{ ansible_managed }}

description "Puma"

start on (filesystem and net-device-up IFACE=lo)
stop on runlevel [!2345]

respawn
respawn limit 3 30

setuid {{ application_user }}
setgid {{ application_user }}

script
exec /bin/bash <<'EOT'

  # Set home env variable, for some reason it was tripping up without this
  export HOME="$(eval echo ~$(id -un))"

  cd {{ application_path }}
  logger -t puma "Starting server: $app"
  exec bundle exec puma -C config/puma.rb
end script